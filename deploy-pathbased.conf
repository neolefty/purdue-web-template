# Deployment Configuration for Path-Based Routing
# This configuration is for apps served under a URL prefix (e.g., /dev/, /staging/)
# Copy this to /etc/template/deploy-pathbased.conf and customize

# Application Settings
APP_NAME="devproject1"
APP_DIR="/opt/apps/devproject1"
APP_USER="nginx"  # Using nginx user as per admin's setup
APP_GROUP="nginx"

# URL Configuration
SERVER_NAME="devapp1.mylab.com"
URL_PREFIX="/dev"  # The path prefix for this app (e.g., /dev, /staging, /prod)
CLIENT_MAX_SIZE="100M"

# SSL Certificate Paths (managed at server level)
SSL_CERT="/etc/nginx/certs/tls.crt"
SSL_KEY="/etc/nginx/certs/tls.key"

# Runtime Paths (using systemd socket activation)
SOCKET_PATH="/run/gunicorn_${APP_NAME}.sock"
PID_FILE="/run/${APP_NAME}.pid"
LOG_DIR="/var/log/${APP_NAME}"

# Database Settings
DB_ENGINE="postgresql"
DB_NAME="${APP_NAME}_db"
DB_USER="${APP_NAME}_user"
DB_PASSWORD=""  # Set in production
DB_HOST="localhost"
DB_PORT="5432"

# Django Settings
DJANGO_SECRET_KEY=""  # Generate with: python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
DJANGO_DEBUG="False"
DJANGO_ALLOWED_HOSTS="${SERVER_NAME},localhost,127.0.0.1"
DJANGO_FORCE_SCRIPT_NAME="${URL_PREFIX}"  # Important for path-based routing
DJANGO_STATIC_URL="${URL_PREFIX}/static/"
DJANGO_MEDIA_URL="${URL_PREFIX}/media/"
DJANGO_LOGIN_URL="${URL_PREFIX}/login/"
DJANGO_LOGIN_REDIRECT_URL="${URL_PREFIX}/"

# Authentication Method
AUTH_METHOD="saml"  # or 'email'

# SAML Settings (adjusted for path-based routing)
SAML_SP_ENTITY_ID="https://${SERVER_NAME}${URL_PREFIX}"
SAML_SP_ACS_URL="https://${SERVER_NAME}${URL_PREFIX}/api/auth/saml/acs/"
SAML_SP_SLS_URL="https://${SERVER_NAME}${URL_PREFIX}/api/auth/saml/sls/"

# Email Settings
EMAIL_HOST="smtp.purdue.edu"
EMAIL_PORT="587"
EMAIL_USE_TLS="True"
EMAIL_HOST_USER=""
EMAIL_HOST_PASSWORD=""
DEFAULT_FROM_EMAIL="noreply@${SERVER_NAME}"

# CORS Settings (include the path prefix)
CORS_ALLOWED_ORIGINS="https://${SERVER_NAME}"

# Frontend Configuration
REACT_APP_API_BASE="${URL_PREFIX}/api"
REACT_APP_BASENAME="${URL_PREFIX}"

# Gunicorn Settings
GUNICORN_WORKERS="3"
GUNICORN_WORKER_CLASS="sync"
GUNICORN_THREADS="1"
GUNICORN_WORKER_CONNECTIONS="1000"
GUNICORN_TIMEOUT="30"
GUNICORN_KEEPALIVE="2"
GUNICORN_MAX_REQUESTS="1000"
GUNICORN_MAX_REQUESTS_JITTER="50"
GUNICORN_BACKLOG="2048"
GUNICORN_LOG_LEVEL="info"
GUNICORN_CAPTURE_OUTPUT="False"
GUNICORN_PRELOAD="False"
GUNICORN_RELOAD="False"
GUNICORN_LIMIT_REQUEST_LINE="4094"
GUNICORN_LIMIT_REQUEST_FIELDS="100"
GUNICORN_LIMIT_REQUEST_FIELD_SIZE="8190"

# Backup Settings
BACKUP_DIR="/var/backups/${APP_NAME}"
BACKUP_RETENTION_DAYS="30"

# Monitoring
HEALTH_CHECK_URL="https://${SERVER_NAME}${URL_PREFIX}/api/health/"
ALERT_EMAIL="admin@purdue.edu"
